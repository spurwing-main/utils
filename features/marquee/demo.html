<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Marquee Feature Demo - Motion+ Style</title>
  <style>
    :root {
      color-scheme: light;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0 auto;
      padding: 2rem 1.5rem 4rem;
      max-width: 960px;
      line-height: 1.55;
      background: #f7f7f8;
      color: #1f2933;
    }

    h1,
    h2,
    h3 {
      margin-top: 2.5rem;
      line-height: 1.2;
    }

    section {
      margin-top: 2rem;
      padding: 1.5rem;
      border-radius: 12px;
      background: white;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.06);
    }

    p {
      margin-block: 0.75rem;
    }

    .marquee-box {
      position: relative;
      margin-top: 1rem;
      border-radius: 10px;
      border: 1px solid rgba(15, 23, 42, 0.08);
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(16, 185, 129, 0.08));
      padding: 1.25rem;
      overflow: hidden;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem 0.9rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.08);
      backdrop-filter: blur(4px);
      font-weight: 500;
    }

    .chip svg {
      width: 1rem;
      height: 1rem;
      color: #0f172a;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .range-label {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 600;
    }

    .range-label input[type='range'] {
      width: 220px;
    }

    button {
      appearance: none;
      border: none;
      border-radius: 999px;
      padding: 0.65rem 1.2rem;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      background: #2563eb;
      color: white;
      transition: transform 150ms ease, background 150ms ease, box-shadow 150ms ease;
      box-shadow: 0 10px 24px rgba(37, 99, 235, 0.25);
    }

    button:hover {
      transform: translateY(-1px);
      background: #1d4ed8;
    }

    button.secondary {
      background: #334155;
      box-shadow: 0 10px 24px rgba(51, 65, 85, 0.25);
    }

    button.danger {
      background: #dc2626;
      box-shadow: 0 10px 24px rgba(220, 38, 38, 0.25);
    }

    button.ghost {
      background: rgba(15, 23, 42, 0.08);
      color: #0f172a;
      box-shadow: none;
    }

    code {
      font-family: "JetBrains Mono", "Fira Code", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
        "Courier New", monospace;
      background: rgba(15, 23, 42, 0.08);
      border-radius: 6px;
      padding: 0.2rem 0.4rem;
      font-size: 0.95rem;
    }

    ul.demo-list {
      display: grid;
      gap: 0.5rem;
      padding-left: 1.5rem;
    }

    .log {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.04);
      font-family: "JetBrains Mono", monospace;
      max-height: 220px;
      overflow: auto;
    }

    .log li {
      list-style: none;
      padding: 0.15rem 0;
    }

    .stacked {
      display: grid;
      gap: 1.25rem;
    }

    .marquee-box button,
    .marquee-box a {
      border-radius: 8px;
      padding: 0.6rem 1rem;
      background: rgba(255, 255, 255, 0.8);
      color: #0f172a;
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.18);
      text-decoration: none;
    }

    .responsive-box {
      transition: max-width 160ms ease;
    }

    .marquee-box a:hover {
      background: rgba(241, 245, 249, 0.95);
    }

    .marquee-box button {
      cursor: pointer;
      border: none;
    }

    .info-box {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(59, 130, 246, 0.1));
      border: 1px solid rgba(139, 92, 246, 0.2);
      border-radius: 10px;
      padding: 1.25rem;
      margin-top: 1rem;
    }

    .info-box h4 {
      margin-top: 0;
      color: #7c3aed;
    }

    .info-box ul {
      margin: 0.5rem 0;
      padding-left: 1.5rem;
    }

    .info-box li {
      margin: 0.25rem 0;
    }

    @media (max-width: 720px) {
      body {
        padding-inline: 1rem;
      }

      section {
        padding: 1.15rem;
      }

      .controls {
        flex-direction: column;
        align-items: stretch;
      }

      button {
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <header>
    <h1>üöÄ Marquee Feature Demo - Motion+ Style</h1>
    <p>
      This marquee uses the <strong>Motion+ Ticker approach</strong> with main thread animation and item translation.
      Watch for buttery smooth 60fps animation with minimal DOM cloning.
    </p>
    <div class="info-box">
      <h4>‚ö° Motion+ Approach Highlights</h4>
      <ul>
        <li><strong>Item Translation:</strong> Items recycle when exiting viewport (50% fewer clones than traditional)</li>
        <li><strong>Main Thread rAF:</strong> Velocity-based animation for consistent speed</li>
        <li><strong>Viewport Awareness:</strong> Auto-pauses when scrolled off-screen (saves CPU/GPU)</li>
        <li><strong>Per-Item Control:</strong> Each item positioned independently via transform</li>
        <li><strong>Minimal Cloning:</strong> Only clones what's needed for initial fill</li>
      </ul>
    </div>
  </header>

  <section id="basic">
    <h2>01. Seamless Loop Test - WATCH FOR JUMPS</h2>
    <p>
      Motion+ style with item translation. Watch the loop boundary carefully. Any visible jump indicates precision issues.
      Items are translated to the end when they exit, creating an infinite loop with minimal clones.
    </p>
    <div class="marquee-box" data-marquee data-marquee-speed="120" style="font-size: 3rem; padding: 3rem 2rem; height: 200px; gap: 4rem;">
      <span class="chip" style="padding: 2rem 3rem; font-size: 2.5rem; background: linear-gradient(135deg, #ef4444, #dc2626); color: white; font-weight: 800;">‚òÖ WATCH FOR JUMPS ‚òÖ</span>
      <span class="chip" style="padding: 2rem 3rem; font-size: 2.5rem; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; font-weight: 800;">‚ö° ITEM TRANSLATION ‚ö°</span>
      <span class="chip" style="padding: 2rem 3rem; font-size: 2.5rem; background: linear-gradient(135deg, #10b981, #059669); color: white; font-weight: 800;">‚úì MOTION+ STYLE ‚úì</span>
      <span class="chip" style="padding: 2rem 3rem; font-size: 2.5rem; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; font-weight: 800;">‚Üí 60FPS SMOOTH ‚Üí</span>
    </div>
  </section>

  <section id="speeds">
    <h2>02. High Speed + Gap Testing</h2>
    <p>High speed marquees with various gap sizes. Motion+ handles all configurations smoothly.</p>
    <div class="stacked">
      <div class="marquee-box" data-marquee data-marquee-speed="180" style="background: #000; padding: 2.5rem; gap: 3rem;">
        <span class="chip" style="padding: 1.5rem 2.5rem; font-size: 2rem; background: #fff; color: #000; font-weight: 900;">‚ñÆ‚ñÆ‚ñÆ BLACK ‚ñÆ‚ñÆ‚ñÆ</span>
        <span class="chip" style="padding: 1.5rem 2.5rem; font-size: 2rem; background: #ff0000; color: #fff; font-weight: 900;">‚ñÆ‚ñÆ‚ñÆ RED ‚ñÆ‚ñÆ‚ñÆ</span>
        <span class="chip" style="padding: 1.5rem 2.5rem; font-size: 2rem; background: #00ff00; color: #000; font-weight: 900;">‚ñÆ‚ñÆ‚ñÆ GREEN ‚ñÆ‚ñÆ‚ñÆ</span>
        <span class="chip" style="padding: 1.5rem 2.5rem; font-size: 2rem; background: #0000ff; color: #fff; font-weight: 900;">‚ñÆ‚ñÆ‚ñÆ BLUE ‚ñÆ‚ñÆ‚ñÆ</span>
      </div>
      <div class="marquee-box" data-marquee data-marquee-speed="220" style="background: linear-gradient(90deg, #1e293b 0%, #334155 100%); padding: 3rem; gap: 5rem;">
        <span class="chip" style="padding: 2rem 3rem; font-size: 2.5rem; background: #fbbf24; color: #000; font-weight: 900; box-shadow: 0 0 30px #fbbf24;">LARGE GAP</span>
        <span class="chip" style="padding: 2rem 3rem; font-size: 2.5rem; background: #a78bfa; color: #fff; font-weight: 900; box-shadow: 0 0 30px #a78bfa;">INHERITED</span>
        <span class="chip" style="padding: 2rem 3rem; font-size: 2.5rem; background: #34d399; color: #000; font-weight: 900; box-shadow: 0 0 30px #34d399;">5REM GAP</span>
      </div>
    </div>
  </section>

  <section id="pause-on-hover">
    <h2>03. Pause on Hover</h2>
    <p>
      Hover over the marquee to pause animation. This uses the <code>data-marquee-pause-on-hover</code> attribute.
      Animation stops smoothly and resumes when you move away.
    </p>
    <div class="marquee-box" data-marquee data-marquee-speed="100" data-marquee-pause-on-hover style="gap: 2rem; cursor: pointer;">
      <span class="chip">üëÜ Hover to Pause</span>
      <span class="chip">Animation Stops</span>
      <span class="chip">Smooth Resume</span>
      <span class="chip">Motion+ Control</span>
      <span class="chip">Perfect for Interactive Content</span>
    </div>
  </section>

  <section id="direction">
    <h2>04. Direction Control</h2>
    <p>
      Set <code>data-marquee-direction="right"</code> to reverse direction. Motion+ handles both directions seamlessly.
    </p>
    <div class="stacked">
      <div class="marquee-box" data-marquee data-marquee-speed="120" style="gap: 1.5rem;">
        <span class="chip">‚Üê Default Left Direction</span>
        <span class="chip">‚Üê Scrolling Left</span>
        <span class="chip">‚Üê Item Translation</span>
      </div>
      <div class="marquee-box" data-marquee data-marquee-speed="120" data-marquee-direction="right" style="gap: 1.5rem; background: linear-gradient(135deg, rgba(236, 72, 153, 0.08), rgba(139, 92, 246, 0.08));">
        <span class="chip">Right Direction ‚Üí</span>
        <span class="chip">Scrolling Right ‚Üí</span>
        <span class="chip">Reverse Translation ‚Üí</span>
      </div>
    </div>
  </section>

  <section id="interactive">
    <h2>05. Interactive Content</h2>
    <p>
      Original items remain fully interactive. Clones are properly hidden with <code>aria-hidden</code> and <code>inert</code>.
      Try clicking or tabbing through - only original items are accessible.
    </p>
    <div class="marquee-box" data-marquee data-marquee-speed="80" data-marquee-pause-on-hover style="gap: 2rem;">
      <a href="https://github.com/spurwing-main/utils" target="_blank" rel="noreferrer">View Source</a>
      <button type="button" onclick="alert('Original button clicked!')">Click Me</button>
      <a href="https://motion.dev" target="_blank" rel="noreferrer">Motion.dev</a>
      <button type="button" onclick="alert('Interactive!')">Test CTA</button>
    </div>
  </section>

  <section id="viewport-aware">
    <h2>06. Viewport Awareness</h2>
    <p>
      Scroll this marquee off-screen and back. <strong>Open DevTools ‚Üí Performance</strong> and record while scrolling.
      You'll see the rAF loop stops when off-screen (saves CPU/GPU). IntersectionObserver handles this automatically.
    </p>
    <div class="marquee-box" data-marquee data-marquee-speed="140" style="gap: 2rem; padding: 3rem;">
      <span class="chip" style="font-size: 1.5rem; padding: 1rem 1.5rem;">üìä Check Performance Tab</span>
      <span class="chip" style="font-size: 1.5rem; padding: 1rem 1.5rem;">‚è∏Ô∏è Pauses Off-Screen</span>
      <span class="chip" style="font-size: 1.5rem; padding: 1rem 1.5rem;">‚ñ∂Ô∏è Resumes On-Screen</span>
      <span class="chip" style="font-size: 1.5rem; padding: 1rem 1.5rem;">üéØ IntersectionObserver</span>
    </div>
  </section>

  <section id="dynamic">
    <h2>07. Dynamic Marquees</h2>
    <p>
      Add or remove marquees at runtime. The feature exposes <code>Marquee.rescan()</code> to discover new nodes.
      Motion+ efficiently manages item translation for all instances.
    </p>
    <div class="controls">
      <button type="button" data-action="add">Add Marquee</button>
      <button type="button" class="secondary" data-action="speed">Toggle Speed (80 ‚ü∑ 200 px/s)</button>
      <button type="button" class="danger" data-action="remove">Remove Marquee</button>
    </div>
    <div id="dynamic-zone" class="stacked" aria-live="polite" aria-label="Dynamic marquee area"></div>
  </section>

  <section id="responsive">
    <h2>08. Responsive Sizing</h2>
    <p>
      Drag the slider to resize the container. ResizeObserver detects changes and rebuilds clones as needed.
      Motion+ minimizes clones based on actual viewport width.
    </p>
    <div class="controls">
      <label class="range-label">
        Width
        <input type="range" min="240" max="720" value="480" data-action="resize-range" aria-label="Responsive marquee width" />
      </label>
      <button type="button" class="ghost" data-action="resize-reset">Reset Width</button>
    </div>
    <div class="marquee-box responsive-box" data-marquee data-marquee-speed="140" style="max-width: 480px; gap: 1.25rem;">
      <span class="chip">üìè Resize-Aware</span>
      <span class="chip">üîÑ Auto-Rebuilds Clones</span>
      <span class="chip">‚ö° Maintains Progress</span>
      <span class="chip">üé® Adaptive Layout</span>
    </div>
  </section>

  <section id="api">
    <h2>09. Global API Helpers</h2>
    <p>
      The loader exposes <code>window.Marquee</code>. Use <code>attach()</code>, <code>detach()</code>, and <code>rescan()</code> directly.
    </p>
    <div class="controls">
      <button type="button" class="ghost" data-action="rescan-global">Rescan Document</button>
      <button type="button" class="ghost" data-action="detach-first">Detach First</button>
      <button type="button" class="ghost" data-action="attach-first">Attach First</button>
    </div>
    <ol class="log" id="log" aria-live="polite"></ol>
  </section>

  <footer>
    <h3>‚ú® Motion+ Implementation Notes</h3>
    <ul class="demo-list">
      <li><strong>Main Thread Animation:</strong> Uses requestAnimationFrame for smooth, velocity-based movement</li>
      <li><strong>Item Translation:</strong> Items recycle when exiting viewport instead of excessive cloning</li>
      <li><strong>Minimal Clones:</strong> Only clones viewport + one cycle worth (50% fewer than traditional WAAPI)</li>
      <li><strong>Viewport Aware:</strong> IntersectionObserver pauses animation when off-screen</li>
      <li><strong>Per-Item Control:</strong> Each item positioned absolutely with individual transforms</li>
      <li><strong>Reduced Motion:</strong> Always honors <code>prefers-reduced-motion</code> preference</li>
      <li><strong>Clean Code:</strong> 425 lines, zero dependencies, modern browser APIs only</li>
    </ul>
  </footer>

  <script type="module" src="../../loader.js" data-features="marquee" data-debug="marquee"></script>
  <script type="module">
    import { Marquee } from './index.js';

    const logList = document.getElementById('log');
    const writeLog = (message) => {
      if (!logList) return;
      const item = document.createElement('li');
      const stamp = new Date().toLocaleTimeString();
      item.textContent = `[${stamp}] ${message}`;
      logList.prepend(item);
      while (logList.childElementCount > 12) {
        logList.removeChild(logList.lastElementChild);
      }
    };

    const dynamicZone = document.getElementById('dynamic-zone');
    let dynamicContainer = null;
    const dynamicSpeeds = [80, 200];
    let dynamicSpeedIndex = 0;

    const buildDynamicMarquee = () => {
      const container = document.createElement('div');
      container.className = 'marquee-box';
      container.dataset.marquee = '';
      container.dataset.marqueeSpeed = String(dynamicSpeeds[dynamicSpeedIndex]);
      container.dataset.marqueePauseOnHover = '';

      container.style.gap = '1.5rem';
      container.append(
        createChip('‚ö° Runtime Marquee'),
        createChip(`Speed: ${dynamicSpeeds[dynamicSpeedIndex]}px/s`),
        createChip('üîÑ Motion+ Item Translation'),
        createChip('üëÜ Hover to Pause'),
      );
      return container;
    };

    function createChip(label) {
      const span = document.createElement('span');
      span.className = 'chip';
      span.textContent = label;
      return span;
    }

    const addBtn = document.querySelector('[data-action="add"]');
    const speedBtn = document.querySelector('[data-action="speed"]');
    const removeBtn = document.querySelector('[data-action="remove"]');

    addBtn?.addEventListener('click', () => {
      if (dynamicContainer) return;
      dynamicContainer = buildDynamicMarquee();
      dynamicZone?.append(dynamicContainer);
      Marquee.rescan();
      writeLog('‚úÖ Added dynamic marquee with Motion+ translation');
    });

    speedBtn?.addEventListener('click', () => {
      if (!dynamicContainer) return;
      dynamicSpeedIndex = (dynamicSpeedIndex + 1) % dynamicSpeeds.length;
      dynamicContainer.dataset.marqueeSpeed = String(dynamicSpeeds[dynamicSpeedIndex]);
      writeLog(`‚ö° Speed ‚Üí ${dynamicContainer.dataset.marqueeSpeed}px/s (velocity-based)`);
    });

    removeBtn?.addEventListener('click', () => {
      if (!dynamicContainer) return;
      dynamicContainer.removeAttribute('data-marquee');
      dynamicContainer.remove();
      dynamicContainer = null;
      writeLog('‚ùå Removed dynamic marquee');
    });

    const responsiveBox = document.querySelector('.responsive-box');
    const resizeRange = document.querySelector('[data-action="resize-range"]');
    const resizeResetBtn = document.querySelector('[data-action="resize-reset"]');
    const defaultResponsiveWidth = 480;

    resizeRange?.addEventListener('input', (event) => {
      if (!responsiveBox) return;
      const nextValue = Number.parseInt(event.target.value, 10);
      responsiveBox.style.maxWidth = `${nextValue}px`;
    });

    resizeRange?.addEventListener('change', (event) => {
      const nextValue = Number.parseInt(event.target.value, 10);
      if (!Number.isFinite(nextValue)) return;
      writeLog(`üìè Responsive width ‚Üí ${nextValue}px (clones rebuilt)`);
    });

    resizeResetBtn?.addEventListener('click', () => {
      if (!responsiveBox || !resizeRange) return;
      responsiveBox.style.maxWidth = `${defaultResponsiveWidth}px`;
      resizeRange.value = String(defaultResponsiveWidth);
      writeLog('üîÑ Responsive width reset');
    });

    const rescanGlobal = document.querySelector('[data-action="rescan-global"]');
    const detachFirst = document.querySelector('[data-action="detach-first"]');
    const attachFirst = document.querySelector('[data-action="attach-first"]');

    rescanGlobal?.addEventListener('click', () => {
      window.Marquee?.rescan();
      writeLog('üîç window.Marquee.rescan()');
    });

    detachFirst?.addEventListener('click', () => {
      const first = document.querySelector('[data-marquee]');
      if (!first) {
        writeLog('‚ùå No marquee to detach');
        return;
      }
      window.Marquee?.detach(first);
      writeLog('‚è∏Ô∏è window.Marquee.detach(first)');
    });

    attachFirst?.addEventListener('click', () => {
      const first = document.querySelector('[data-marquee]') ?? document.querySelector('.marquee-box');
      if (!first) {
        writeLog('‚ùå No marquee element found');
        return;
      }
      window.Marquee?.attach(first);
      writeLog('‚ñ∂Ô∏è window.Marquee.attach(first)');
    });
  </script>
</body>

</html>
